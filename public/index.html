<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<style type="text/css">
		body {text-align: center;}
	</style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body>

	<canvas id="canvas" width="800" height="400"></canvas>

	<script src="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/js/font-awesome.min.js"></script>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		var DIRECTION = {
			IDLE: 0,
			UP: 1,
			DOWN: 2,
			LEFT: 3,
			RIGHT: 4
		};
		var rounds = [5, 5, 3, 3, 2];
		var colors = ['#1abc9c', '#2ecc71', '#3498db', '#e74c3c', '#9b59b6'];
		var brands = ["\uf092", "\uf0d4", "\uf08c", "\uf3bb", "\uf2d8", "\uf1d2", "\uf082", "\uf167", "\uf081"];
		var ballCode = "\uf1a1";
		var player;
		var paddle;
		var ball;

		app.onInit = function(){
			this.canvas.style.width = (this.canvas.width / 2) + 'px';
			this.canvas.style.height = (this.canvas.height / 2) + 'px';

			this.nodes.push({
				id: 'paddle',
				width: 18,
				height: 70,
				x: 150,
				y: (this.canvas.height / 2) - 35,
				font: null,
				color  : 'red',
				score: 0,
				move: DIRECTION.IDLE,
				speed: 10
			});

			this.nodes.push({
				id: 'player',
				width: 18,
				height: 70,
				x: this.canvas.width - 150,
				y: (this.canvas.height / 2) - 35,
				font: null,
				color  : 'black',
				score: 0,
				move: DIRECTION.IDLE,
				speed: 10
			});

			this.nodes.push({
				id: 'ball',
				width: 20,
				height: 20,
				fontCode: ballCode,
				fontColor: '#000',
				color  : 'transparent',
				x: (this.canvas.width / 2) - 9,
				y: (this.canvas.height / 2) - 9,
				moveX: DIRECTION.IDLE,
				moveY: DIRECTION.IDLE,
				speed: 9
			});
/*
			for (var i = 9; i >= 0; i--) {
				this.nodes.push({
					id: 'bonus_'+i,
					width: 1,
					height: 1,
					font: brands[i],
					x: (this.canvas.width / 2) - 9,
					y: (this.canvas.height / 2) - 9,
				});
			}
*/
			paddle = this.getNode('paddle');
			player = this.getNode('player');
			paddle.speed = 8;

			this.running = this.over = false;
			this.turn = this.paddle;
			this.timer = this.round = 0;
			this.color = '#2c3e50';

			app.listen();
		};

		app.listen = function(){
			document.addEventListener('keydown', function (key) {
				if (this.running === false) {
					this.running = true;
					window.requestAnimationFrame(this.loop);
				}
				if (key.keyCode === 38 || key.keyCode === 87)
					player.move = DIRECTION.UP;

				if (key.keyCode === 40 || key.keyCode === 83)
					player.move = DIRECTION.DOWN;
			});

			document.addEventListener('keyup', function (key) { player.move = DIRECTION.IDLE; });
		};

		app.updateFonts = function () {
		    var dt = Date.now() - this.lastUpdate;

			for(var index in this.nodes){
				var node = this.nodes[index];
				if(node.fontCode !== null){
					this.context.fillStyle = node.fontColor;
					this.context.font = '64px FontAwesome';
					this.context.textAlign = 'center';
					this.context.textBaseline = 'middle';
					this.context.fillText(node.fontCode, node.x+(node.width/2), node.y+(node.height));
				}
			}
			this.lastUpdate = Date.now();
			this.timestamp += dt;
		};

		app.netLine = function() {
			this.context.beginPath();
			this.context.setLineDash([7, 15]);
			this.context.moveTo((this.canvas.width / 2), 0);
			this.context.lineTo((this.canvas.width / 2), this.canvas.height);
			this.context.lineWidth = 10;
			this.context.strokeStyle = '#000';
			this.context.stroke();
		};

		app._resetTurn = function(victor, loser) {
//			this.ball = Ball.new.call(this, this.ball.speed);
			this.turn = loser;
			this.timer = (new Date()).getTime();

			victor.score++;
		};

		app.onUpdate = function(time) {

			this.updateFonts();
			this.netLine();

			// If the ball collides with the bound limits - correct the x and y coords.
			if (this.getNode('ball').x <= 0) 
				app._resetTurn.call(this, this.getNode('paddle'), this.getNode('player'));

			if (this.getNode('ball').x >= this.canvas.width - this.getNode('ball').width) 
				app._resetTurn.call(this, this.getNode('player'), this.getNode('paddle'));

			if (this.getNode('ball').y <= 0) 
				this.getNode('ball').moveY = DIRECTION.DOWN;

			if (this.getNode('ball').y >= this.canvas.height - this.getNode('ball').height) 
				this.getNode('ball').moveY = DIRECTION.UP;

			if (!this.over) {
				// Move player if they player.move value was updated by a keyboard event
				if (this.getNode('player').move === DIRECTION.UP) 
					this.getNode('player').y -= this.getNode('player').speed;
				else if (this.getNode('player').move === DIRECTION.DOWN) 
					this.getNode('player').y += this.getNode('player').speed;


				// If the player collides with the bound limits, update the x and y coords.
				if (this.getNode('player').y <= 0) 
					this.getNode('player').y = 0;
				else if (this.getNode('player').y >= (this.canvas.height - this.getNode('player').height)) 
					this.getNode('player').y = (this.canvas.height - this.getNode('player').height);
			}

		};
	</script>
</body>
</html>